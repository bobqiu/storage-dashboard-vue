(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e2d"],{"06b2":function(t,e,s){"use strict";s.d(e,"b",function(){return l}),s.d(e,"g",function(){return c}),s.d(e,"e",function(){return p}),s.d(e,"f",function(){return h}),s.d(e,"d",function(){return f}),s.d(e,"a",function(){return _}),s.d(e,"c",function(){return b});s("6b54"),s("c5f6"),s("28a5"),s("ac6a");var a=s("8afe"),i=(s("96cf"),s("3040")),o=s("ff66"),n=s("dd1f"),r=s("2587"),u=s.n(r),l=function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(o["c"])({timeout:1e4,host:n["a"].policyHOST});case 2:return s=t.sent,t.abrupt("return",new Promise(function(t,a){return s.getBucketPolicy({Bucket:e},function(s,i){return s&&"PolicyNotFound"!==s.code?a(s):t({bucket:e,data:i})})}));case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),c=function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e,s){var a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a={name:"post_upload_transcoding",value:s},t.prev=1,t.abrupt("return",Object(o["d"])("putBucketPolicy",{Bucket:e,Policy:JSON.stringify(a)},n["a"].policyHOST));case 5:return t.prev=5,t.t0=t["catch"](1),t.abrupt("return",Promise.reject(t.t0));case 8:case"end":return t.stop()}},t,this,[[1,5]])}));return function(e,s){return t.apply(this,arguments)}}(),p=function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var s,a,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,l(e);case 3:return s=t.sent,a=s.data&&s.data.Policy?JSON.parse(s.data.Policy):{},i=[],a&&a.post_upload_transcoding&&a.post_upload_transcoding.length>0&&(i=a.post_upload_transcoding),t.abrupt("return",i);case 10:t.prev=10,t.t0=t["catch"](0),u.a.Message.error(t.t0.message,5);case 13:case"end":return t.stop()}},t,this,[[0,10]])}));return function(e){return t.apply(this,arguments)}}(),d=[],h=function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return d=[],t.next=3,m();case 3:return t.abrupt("return",d);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),m=function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var s,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e){t.next=7;break}return t.next=4,Object(o["e"])("listPipelines");case 4:t.t0=t.sent,t.next=10;break;case 7:return t.next=9,Object(o["e"])("listPipelines",{PageToken:e});case 9:t.t0=t.sent;case 10:if(i=t.t0,(s=d).push.apply(s,Object(a["a"])(i.Pipelines)),!i.NextPageToken){t.next=15;break}return t.next=15,m(i.NextPageToken);case 15:t.next=20;break;case 17:t.prev=17,t.t1=t["catch"](0),u.a.Message.error(t.t1.message,5);case 20:case"end":return t.stop()}},t,this,[[0,17]])}));return function(e){return t.apply(this,arguments)}}(),f=function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,s,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return I=[],t.next=3,v();case 3:return e=[],s=[],a=[],I.forEach(function(t){e[t.Id]=t.Container}),I.forEach(function(t){s[t.Id]=t.Name,a[t.Id]=t.Video.Codec}),t.abrupt("return",{templateList:I,templateContainer:e,templateVideoCodec:a,templateName:s});case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),I=[],v=function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var s,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e){t.next=6;break}return t.next=3,Object(o["e"])("listPresets");case 3:t.t0=t.sent,t.next=9;break;case 6:return t.next=8,Object(o["e"])("listPresets",{PageToken:e});case 8:t.t0=t.sent;case 9:if(i=t.t0,(s=I).push.apply(s,Object(a["a"])(i.Presets)),!i.NextPageToken){t.next=14;break}return t.next=14,v(i.NextPageToken);case 14:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),_=function(t){var e=Math.floor(t/1e3);return["".concat(Math.floor(e/3600),":").concat(Math.floor(e/60)%60,":").concat(e%60),"".concat(t%1e3)]},b=function(t,e){var s=t.split(":").map(function(t){return Number(t)});return(1e3*(3600*s[0]+60*s[1]+s[2])+Number(e)).toString()}},2599:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bsc-job-edit bsc-edit"},[s("div",{staticClass:"layout-bsc-toolbar"},[s("Breadcrumb",[s("Breadcrumb-item",{attrs:{href:"/video/JobList"}},[t._v(t._s(t.$t("VIDEO.JOB_CONF")))]),s("Breadcrumb-item",[t._v(t._s(t.$t("VIDEO.JOB_CREATE")))])],1)],1),s("Form",{ref:"jobForm",attrs:{model:t.job,rules:t.ruleValidate,"label-width":170}},[s("div",{staticClass:"separator-line"}),s("div",{staticClass:"editBlock"},[s("div",{staticClass:"section-separator"},[s("div",{staticClass:"separator-body"},[s("span",{staticClass:"separator-icon"}),s("span",{staticClass:"separator-info"},[t._v(t._s(t.$t("VIDEO.BASIC_SET")))])])]),s("div",{staticClass:"form-item"},[s("FormItem",{attrs:{label:t.$t("VIDEO.JOB_PIPE"),prop:"PipelineId",required:""}},[s("Select",{staticClass:"line-width",on:{"on-change":t.pipeChange},model:{value:t.job.PipelineId,callback:function(e){t.$set(t.job,"PipelineId",e)},expression:"job.PipelineId"}},t._l(t.pipes,function(e){return s("Option",{key:e.Id,attrs:{value:e.Id}},[t._v(t._s(e.Name))])}))],1)],1)]),s("div",{staticClass:"separator-line"}),s("div",{staticClass:"editBlock"},[s("div",{staticClass:"section-separator"},[s("div",{staticClass:"separator-body"},[s("span",{staticClass:"separator-icon"}),s("span",{staticClass:"separator-info"},[t._v(t._s(t.$t("VIDEO.INPUT_CONFIGURATION")))])])]),s("div",{staticClass:"form-item"},[s("span",{staticClass:"form-label required-item"},[t._v(t._s(t.$t("VIDEO.SRC_FILE"))+" : ")]),s("div",{staticClass:"section-search"},[s("span",{staticClass:"bsc-input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchValue,expression:"searchValue"}],attrs:{type:"text"},domProps:{value:t.searchValue},on:{input:function(e){e.target.composing||(t.searchValue=e.target.value)}}}),s("Button",{attrs:{type:"text",size:"small"},on:{click:function(e){t.getFiles(t.searchValue)}}},[s("Icon",{attrs:{type:"search",size:t.iconSize}})],1)],1)]),t.fileInfo?s("p",{staticClass:"style-name-info"},[t._v(t._s(t.$t("VIDEO.SEARCH_INFO")))]):t._e()]),s("div",{staticClass:"form-item"},[s("FormItem",{attrs:{prop:"Inputs"}},[s("Select",{staticClass:"line-width",model:{value:t.job.Inputs[0].Key,callback:function(e){t.$set(t.job.Inputs[0],"Key",e)},expression:"job.Inputs[0].Key"}},t._l(t.fileList,function(e){return s("Option",{key:e.Key,attrs:{value:e.Key}},[t._v(t._s(e.Key))])}))],1)],1)]),s("div",{staticClass:"separator-line"}),s("div",{staticClass:"editBlock"},[s("div",{staticClass:"section-separator"},[s("div",{staticClass:"separator-body"},[s("span",{staticClass:"separator-icon"}),s("span",{staticClass:"separator-info"},[t._v(t._s(t.$t("VIDEO.OUTPUT_CONFIGURATION")))])])]),s("div",{staticClass:"form-item"},[s("span",{staticClass:"form-label"},[t._v(t._s(t.$t("VIDEO.OUTPUT_KEY_PREFIX"))+" : ")]),s("Input",{staticClass:"line-width",attrs:{placeholder:t.$t("VIDEO.OUTPUT_KEY_PREFIX")},model:{value:t.job.OutputKeyPrefix,callback:function(e){t.$set(t.job,"OutputKeyPrefix",e)},expression:"job.OutputKeyPrefix"}})],1),s("div",{staticClass:"form-item"},[s("span",{staticClass:"form-label"},[t._v(t._s(t.$t("VIDEO.OUTPUT_RULES"))+" : ")]),s("div",{staticClass:"table-box line-width"},[s("Table",{attrs:{border:"",size:"small",context:t.self,stripe:!0,columns:t.outputsHeader,data:t.job.Outputs,"no-data-text":t.$t("VIDEO.AT_LEAST_ONE_RULE")}})],1),s("br"),t.HLSError?s("p",{staticClass:"style-name-info redFont"},[t._v(t._s(t.$t("VIDEO.AUTO_OUTPUT_RULES_DESCRIPTION")))]):t._e(),s("Button",{staticClass:"button-add-item",attrs:{icon:"plus",size:"small"},on:{click:t.addOutput}},[t._v(t._s(t.$t("PUBLIC.ADD")))])],1),s("div",{staticClass:"form-item"},[s("span",{staticClass:"form-label"},[t._v(t._s(t.$t("VIDEO.VIDEO_SCREENSHOTS_RULES"))+" : ")]),s("div",{staticClass:"table-box line-width"},[s("Table",{attrs:{border:"",size:"small",context:t.self,stripe:!0,columns:t.shotsHeader,data:t.job.Snapshots,"no-data-text":t.$t("VIDEO.AT_LEAST_ONE_RULE")}})],1),s("br"),t.osError?s("p",{staticClass:"style-name-info redFont"},[t._v(t._s(t.$t("VIDEO.AT_LEAST_ONE_RULE")))]):t._e(),s("Button",{staticClass:"button-add-item",attrs:{icon:"plus",size:"small"},on:{click:t.addShot}},[t._v(t._s(t.$t("PUBLIC.ADD")))])],1)]),s("div",{staticClass:"separator-line"}),s("div",{staticClass:"editBlock"},[s("div",{staticClass:"section-separator"},[s("div",{staticClass:"separator-body"},[s("span",{staticClass:"separator-icon"}),s("span",{staticClass:"separator-info"},[t._v(t._s(t.$t("VIDEO.MASTER_PLAYLIST_CONFIGURATION")))])])]),s("div",{staticClass:"form-item"},[s("span",{staticClass:"form-label"},[t._v(t._s(t.$t("VIDEO.WHETHER_TO_OPEN"))+" : ")]),s("i-switch",{staticStyle:{"margin-top":"3px"},model:{value:t.MPOpen,callback:function(e){t.MPOpen=e},expression:"MPOpen"}},[s("span",{attrs:{slot:"open"},slot:"open"},[t._v(t._s(t.$t("VIDEO.ON")))]),s("span",{attrs:{slot:"close"},slot:"close"},[t._v(t._s(t.$t("VIDEO.OFF")))])])],1),t.MPOpen?s("div",{staticClass:"form-item"},[s("span",{staticClass:"form-label"},[t._v(t._s(t.$t("VIDEO.SLICE_FORMAT"))+" : ")]),s("Radio-group",{model:{value:t.job.Playlists.Format,callback:function(e){t.$set(t.job.Playlists,"Format",e)},expression:"job.Playlists.Format"}},[s("Radio",{key:"HLSv3",attrs:{label:"HLSv3"}},[t._v("HLSv3")])],1)],1):t._e(),t.MPOpen?s("div",{staticClass:"form-item"},[s("FormItem",{attrs:{label:t.$t("VIDEO.HLS_FILE_NAME"),prop:"Playlists.Name",required:""}},[s("Input",{staticClass:"line-width",attrs:{placeholder:"MasterPlaylist"},model:{value:t.job.Playlists.Name,callback:function(e){t.$set(t.job.Playlists,"Name",e)},expression:"job.Playlists.Name"}})],1)],1):t._e(),t.MPOpen?s("div",{staticClass:"form-item"},[s("FormItem",{attrs:{label:t.$t("VIDEO.OUTPUT_FILE_NAME")+" : ",prop:"Playlists.OutputKeys",required:""}},[s("Select",{staticClass:"line-width",attrs:{multiple:""},model:{value:t.job.Playlists.OutputKeys,callback:function(e){t.$set(t.job.Playlists,"OutputKeys",e)},expression:"job.Playlists.OutputKeys"}},t._l(t.MPNames,function(e){return s("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}))],1)],1):t._e()]),s("div",{staticClass:"separator-line"}),s("div",{staticClass:"editBlock"},[s("Button",{staticClass:"button-save",attrs:{type:"primary"},on:{click:t.beforeSubmit}},[t._v(t._s(t.$t("VIDEO.SAVE")))])],1)]),s("Modal",{staticClass:"edit-modal",attrs:{title:t.$t("VIDEO.OUTPUT_RULES"),width:"700"},model:{value:t.showOutputsModal,callback:function(e){t.showOutputsModal=e},expression:"showOutputsModal"}},[s("Form",{ref:"outputForm",attrs:{model:t.outputModal,"label-width":155,rules:t.ruleValidate}},[s("FormItem",{attrs:{label:t.$t("VIDEO.TRANSCODING_TEMPLATE")+" : ",prop:"PresetId",required:""}},[s("Select",{staticClass:"line-width",attrs:{filterable:""},on:{"on-change":t.templateChange},model:{value:t.outputModal.PresetId,callback:function(e){t.$set(t.outputModal,"PresetId",e)},expression:"outputModal.PresetId"}},t._l(t.templateInfo.templateList,function(e){return s("Option",{key:e.Id,attrs:{value:e.Id}},[t._v(t._s(e.Name))])}))],1),s("FormItem",{attrs:{label:t.$t("VIDEO.OUTPUT_FILE_NAME")+" : ",prop:"Key",required:""}},[s("Input",{staticClass:"line-width",attrs:{placeholder:t.$t("VIDEO.OUTPUT_FILE_NAME")},model:{value:t.outputModal.Key,callback:function(e){t.$set(t.outputModal,"Key",e)},expression:"outputModal.Key"}})],1),t.HLSShow?s("FormItem",{attrs:{label:t.$t("VIDEO.HLS_SLICE_LENGTH")+" : ",prop:"SegmentDuration"}},[s("Slider",{staticClass:"my-slider",attrs:{min:0,max:50,"show-input":""},model:{value:t.outputModal.SegmentDuration,callback:function(e){t.$set(t.outputModal,"SegmentDuration",e)},expression:"outputModal.SegmentDuration"}})],1):t._e(),s("FormItem",{attrs:{label:"视频剪辑 : "}},[s("i-switch",{staticStyle:{"margin-top":"3px"},model:{value:t.isComposition,callback:function(e){t.isComposition=e},expression:"isComposition"}},[s("span",{attrs:{slot:"open"},slot:"open"},[t._v(t._s(t.$t("VIDEO.ON")))]),s("span",{attrs:{slot:"close"},slot:"close"},[t._v(t._s(t.$t("VIDEO.OFF")))])])],1),t.isComposition?s("FormItem",{attrs:{label:"剪辑开始时间 : "}},[s("TimePicker",{staticStyle:{width:"168px"},attrs:{type:"time",placeholder:"时分秒",value:t.outputModal.StartTime},on:{"on-change":function(e){return t.timeChange(e,"StartTime")}}}),t._v(" .\n        "),s("InputNumber",{attrs:{min:0},model:{value:t.outputModal.StartTimeMS,callback:function(e){t.$set(t.outputModal,"StartTimeMS",e)},expression:"outputModal.StartTimeMS"}}),t._v(" ms\n      ")],1):t._e(),t.isComposition?s("FormItem",{attrs:{label:"剪辑时长 : "}},[s("TimePicker",{staticStyle:{width:"168px"},attrs:{type:"time",placeholder:"时分秒",value:t.outputModal.Duration},on:{"on-change":function(e){return t.timeChange(e,"Duration")}}}),t._v(" .\n        "),s("InputNumber",{attrs:{min:0},model:{value:t.outputModal.DurationMS,callback:function(e){t.$set(t.outputModal,"DurationMS",e)},expression:"outputModal.DurationMS"}}),t._v(" ms\n      ")],1):t._e(),t.isAutoCodec?s("p",{staticClass:"page-info",staticStyle:{"padding-left":"155px"}},[t._v("转码模版的视频编码方式为“不变”时不能添加水印")]):t._e(),s("FormItem",{attrs:{label:"水印 : "}},[s("i-switch",{staticStyle:{"margin-top":"3px"},attrs:{disabled:t.isAutoCodec},model:{value:t.isWaterMarkerOpen,callback:function(e){t.isWaterMarkerOpen=e},expression:"isWaterMarkerOpen"}},[s("span",{attrs:{slot:"open"},slot:"open"},[t._v(t._s(t.$t("VIDEO.ON")))]),s("span",{attrs:{slot:"close"},slot:"close"},[t._v(t._s(t.$t("VIDEO.OFF")))])])],1),t.isWaterMarkerOpen?s("FormItem",{attrs:{label:"文件Key : ",prop:"InputKey"}},[s("Input",{staticClass:"line-width",attrs:{placeholder:"水印图片要和视频源文件在一个bucket里，输入文件key即可，例如abc.png",disabled:t.isAutoCodec},model:{value:t.outputModal.InputKey,callback:function(e){t.$set(t.outputModal,"InputKey",e)},expression:"outputModal.InputKey"}})],1):t._e()],1),s("div",{staticClass:"copy-modal-footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"primary"},on:{click:t.beforeUpdateOutputs}},[t._v(t._s(t.$t("VIDEO.OK")))])],1)],1),s("Modal",{staticClass:"edit-modal",attrs:{title:t.$t("VIDEO.SNAPSHOTS_RULES"),width:"700"},model:{value:t.showShotsModal,callback:function(e){t.showShotsModal=e},expression:"showShotsModal"}},[s("Form",{ref:"shotsForm",attrs:{model:t.shotModal,"label-width":0,rules:t.ruleValidate,inline:""}},[s("div",{staticClass:"form-item mar-b-0"},[s("span",{staticClass:"form-label required-item"},[t._v(t._s(t.$t("VIDEO.OUTPUT_FILE_NAME_SUFFIX"))+" : ")]),s("FormItem",{attrs:{prop:"Key",required:""}},[s("Input",{staticStyle:{width:"160px"},attrs:{placeholder:t.$t("VIDEO.OUTPUT_FILE_NAME_SUFFIX")},model:{value:t.shotModal.Key,callback:function(e){t.$set(t.shotModal,"Key",e)},expression:"shotModal.Key"}})],1),s("Select",{staticStyle:{width:"100px",display:"inline-block"},model:{value:t.shotModal.Format,callback:function(e){t.$set(t.shotModal,"Format",e)},expression:"shotModal.Format"}},t._l(t.formatList,function(e){return s("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}))],1),s("div",{staticClass:"form-item mar-b-0"},[s("span",{staticClass:"form-label"},[t._v(t._s(t.$t("VIDEO.SCREENSHOT_START_TIME"))+" : ")]),s("FormItem",{attrs:{prop:"Time"}},[s("InputNumber",{model:{value:t.shotModal.Time,callback:function(e){t.$set(t.shotModal,"Time",e)},expression:"shotModal.Time"}}),t._v(" S\n        ")],1)],1),s("div",{staticClass:"form-item"},[s("span",{staticClass:"form-label"},[t._v(t._s(t.$t("VIDEO.SCREENSHOT_INTERVAL"))+" : ")]),s("InputNumber",{attrs:{min:1},model:{value:t.shotModal.Interval,callback:function(e){t.$set(t.shotModal,"Interval",e)},expression:"shotModal.Interval"}}),t._v(" S\n      ")],1),s("div",{staticClass:"form-item"},[s("span",{staticClass:"form-label"},[t._v(t._s(t.$t("VIDEO.SCREENSHOT_MAX_NUMBER"))+" : ")]),s("InputNumber",{attrs:{min:1},model:{value:t.shotModal.Number,callback:function(e){t.$set(t.shotModal,"Number",e)},expression:"shotModal.Number"}})],1),s("div",{staticClass:"form-item mar-b-0"},[s("span",{staticClass:"form-label"},[t._v(t._s(t.$t("VIDEO.RESOLUTION"))+" : ")]),s("Radio-group",{model:{value:t.shotModal.Resolution,callback:function(e){t.$set(t.shotModal,"Resolution",e)},expression:"shotModal.Resolution"}},[s("Radio",{attrs:{label:"auto"}},[t._v(t._s(t.$t("VIDEO.UNALTERED")))]),s("Radio",{attrs:{label:"value"}})],1),s("FormItem",{attrs:{prop:"width"}},[s("InputNumber",{attrs:{disabled:"auto"===t.shotModal.Resolution,placeholder:t.$t("VIDEO.WIDTH")},model:{value:t.shotModal.width,callback:function(e){t.$set(t.shotModal,"width",e)},expression:"shotModal.width"}})],1),s("FormItem",{attrs:{prop:"height"}},[s("InputNumber",{attrs:{disabled:"auto"===t.shotModal.Resolution,placeholder:t.$t("VIDEO.HEIGHT")},model:{value:t.shotModal.height,callback:function(e){t.$set(t.shotModal,"height",e)},expression:"shotModal.height"}})],1)],1),s("div",{staticClass:"form-item"},[s("span",{staticClass:"form-label"},[t._v(t._s(t.$t("VIDEO.ASPECT_RATIO"))+" : ")]),s("Radio-group",{model:{value:t.shotModal.AspectRatio,callback:function(e){t.$set(t.shotModal,"AspectRatio",e)},expression:"shotModal.AspectRatio"}},t._l(t.aspectRatioList,function(e){return s("Radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.name))])}))],1)]),s("div",{staticClass:"copy-modal-footer\n                 ",attrs:{slot:"footer\n                 "},slot:"footer\n                 "},[s("Button",{attrs:{type:"primary\n                 "},on:{click:t.beforeUpdateShots}},[t._v(t._s(t.$t("VIDEO.OK")))])],1)],1)],1)},i=[],o=(s("c5f6"),s("7cdf"),s("28a5"),s("f751"),s("c93e")),n=(s("6b54"),s("ac6a"),s("4f7f"),s("96cf"),s("3040")),r=s("06b2"),u=s("ff66"),l=s("752a"),c={data:function(){var t=this;return{iconSize:18,self:this,pipes:[],job:_.cloneDeep(p),showOutputsModal:!1,showShotsModal:!1,fileModelShow:!1,outputModal:_.clone(d),shotModal:_.clone(h),HLSShow:!1,HLSError:!1,pipeInputBucket:"",formatList:["png","jpg"],templateInfo:{},MPOpen:!1,MPNames:[],fileList:[],fileInfo:!1,searchValue:"",isWaterMarkerOpen:!1,isAutoCodec:!1,isComposition:!1,ruleValidate:{"Playlists.Name":[{validator:this.validateName,trigger:"change"}],"Playlists.OutputKeys":[{validator:this.validateOutputKeys,trigger:"change"}],Inputs:[{validator:this.validateInputs,trigger:"change"}],SegmentDuration:[{validator:this.validateSegment,trigger:"blur"}],InputKey:[{validator:this.validateInputKey,trigger:"change"}],PresetId:[{required:!0,message:this.$t("VIDEO.PERSET_REQUIRED"),trigger:"change"}],Key:[{required:!0,message:this.$t("VIDEO.KEY_SUFFIX_REQUIRED"),trigger:"change"}],Time:[{type:"number",min:1,message:this.$t("PUBLIC.NOT_LESS",{num:"1"}),trigger:"change"}],width:[{validator:this.validateWidth,trigger:"change"}],height:[{validator:this.validateWidth,trigger:"change"}]},aspectRatioList:[{name:this.$t("VIDEO.UNALTERED"),value:"auto"},{name:"1:1",value:"1:1"},{name:"4:3",value:"4:3"},{name:"3:2",value:"3:2"},{name:"16:9",value:"16:9"}],outputsHeader:[{title:this.$t("VIDEO.OUTPUT_FILE_NAME"),key:"Key",width:140},{title:this.$t("VIDEO.TRANSCODING_TEMPLATE"),key:"template",width:100},{title:this.$t("VIDEO.HLS_SLICE_LENGTH"),width:120,key:"SegmentDuration"},{title:"水印文件Key",width:120,key:"watermarkers",render:function(t,e){return t("div",[e.row.Watermarks?e.row.Watermarks[0].InputKey:"水印未启用"])}},{title:"Actions",key:"actions",width:120,render:function(e,s){return e("div",[e("Tooltip",{props:{content:t.$t("PUBLIC.EDIT"),delay:1e3,placement:"top"},class:{"mar-r-5":!0}},[e("i-button",{props:{size:"small"},on:{click:function(){t.editOutput(s.row._index)}}},[e("Icon",{props:{type:"compose",size:t.iconSize}})])]),e("Tooltip",{props:{content:t.$t("PUBLIC.DELETE"),delay:1e3,placement:"top"},class:{"mar-r-5":!0}},[e("i-button",{props:{size:"small"},on:{click:function(){t.deleteOutput(s.row._index)}}},[e("Icon",{props:{type:"ios-trash",size:t.iconSize}})])])])}}],shotsHeader:[{title:this.$t("VIDEO.OUTPUT_FILE_NAME_SUFFIX"),key:"Key",width:140},{title:this.$t("VIDEO.FORMAT"),key:"Format",width:70},{title:this.$t("VIDEO.SCREENSHOT_START_TIME_SECOND"),width:160,key:"Time"},{title:this.$t("VIDEO.SCREENSHOT_INTERVAL_SECOND"),width:140,key:"Interval"},{title:this.$t("VIDEO.SCREENSHOT_MAX_NUMBER"),width:120,key:"Number"},{title:this.$t("VIDEO.SCREENSHOT_RESOLUTION"),width:100,key:"Resolution"},{title:this.$t("VIDEO.ASPECT_RATIO"),width:80,key:"AspectRatio"},{title:"Actions",key:"actions",width:100,render:function(e,s){return e("div",[e("Tooltip",{props:{content:t.$t("PUBLIC.EDIT"),delay:1e3,placement:"top"},class:{"mar-r-5":!0}},[e("i-button",{props:{size:"small"},on:{click:function(){t.editShot(s.row._index)}}},[e("Icon",{props:{type:"compose",size:t.iconSize}})])]),e("Tooltip",{props:{content:t.$t("PUBLIC.DELETE"),delay:1e3,placement:"top"}},[e("i-button",{props:{size:"small"},on:{click:function(){t.deleteShot(s.row._index)}}},[e("Icon",{props:{type:"ios-trash",size:t.iconSize}})])])])}}]}},computed:{osError:function(){return 0===this.job.Snapshots.length&&0===this.job.Outputs.length}},created:function(){this.createdMethods()},methods:{createdMethods:function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(r["d"])();case 2:return this.templateInfo=t.sent,t.next=5,Object(r["f"])();case 5:e=t.sent,this.pipes=e.filter(function(t){return"Active"===t.Status}),this.pipes[0]?(this.job.PipelineId=this.pipes[0].Id,this.pipeInputBucket=this.pipes[0].InputBucket):this.$Message.warning(this.$t("VIDEO.PIPE_FIRST"));case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),beforeSubmit:function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.$refs["jobForm"].validate(function(t){t?e.otherRule()&&e.createJob():e.$Message.error(e.$t("PUBLIC.FORM_VALID_FAILED"))});case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),otherRule:function(){var t=this,e=[],s=new Set;if(this.osError)return this.$Message.warning(this.$t("VIDEO.AT_LEAST_ONE_RULE")),!1;if(this.MPOpen){if(this.job.Outputs.forEach(function(a){t.isTS(a.PresetId)&&(e.push(a.SegmentDuration||0),s.add(a.SegmentDuration||0))}),0===e.length)return this.$Message.warning(this.$t("VIDEO.ADAPTIVE_EXIST_TS_FORMAT")),this.HLSError=!0,!1;if(1!==s.size)return this.$Message.warning(this.$t("VIDEO.ADAPTIVE_HLS_SLICE_LENGTH_CONSISTENT")),this.HLSError=!0,!1;if(0===e[0])return this.$Message.warning(this.$t("VIDEO.ADAPTIVE_HLS_SLICE_LENGTH_CANNOT_BE_0")),this.HLSError=!0,!1}return!0},createJob:function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.convert2Save(this.job);case 2:return e=t.sent,t.prev=3,this.$Loading.start(),t.next=7,this.$http.post(Object(l["A"])("jobs"),e);case 7:this.$Loading.finish(),this.$Message.success(this.$t("VIDEO.CREATED")),this.$router.push({name:"job"}),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](3),this.$Loading.error();case 15:case"end":return t.stop()}},t,this,[[3,12]])}));return function(){return t.apply(this,arguments)}}(),convert2Save:function(t){var e=_.clone(t),s=_.clone(t);return 0===t.Outputs.length?delete s.Outputs:s.Outputs=e.Outputs.map(function(t){var e=_.clone(t);return t.SegmentDuration&&0!==t.SegmentDuration?e.SegmentDuration=t.SegmentDuration.toString():delete e.SegmentDuration,delete e.template,e}),0===t.Snapshots.length?delete s.Snapshots:s.Snapshots=e.Snapshots.map(function(t){var e=_.clone(t);return e.Interval=t.Interval.toString(),e.Number=t.Number.toString(),e.Time=t.Time.toString(),e}),this.MPOpen?s.Playlists=[Object(o["a"])({},e.Playlists)]:delete s.Playlists,s},addOutput:function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.outputModal=_.clone(d),this.outputIndex=this.job.Outputs.length,this.showOutputsModal=!0,this.isWaterMarkerOpen=!1,this.isComposition=!1,this.HLSError=!1;case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),editOutput:function(t){this.outputIndex=t,this.outputModal=_.clone(this.job.Outputs[t]),this.outputModal.SegmentDuration=parseInt(this.outputModal.SegmentDuration),this.outputModal.InputKey=this.outputModal.Watermarks?this.outputModal.Watermarks[0].InputKey:"",this.isWaterMarkerOpen=!!this.outputModal.Watermarks,this.isTS(this.outputModal.PresetId)?this.HLSShow=!0:this.HLSShow=!1,this.isAutoCodec=this.isAC(this.outputModal.PresetId),this.isComposition=!!this.outputModal.Composition,this.outputModal.StartTime=this.outputModal.Composition?Object(r["a"])(this.outputModal.Composition[0].TimeSpan.StartTime)[0]:"0:0:0",this.outputModal.StartTimeMS=this.outputModal.Composition?Object(r["a"])(this.outputModal.Composition[0].TimeSpan.StartTime)[1]:"0",this.outputModal.Duration=this.outputModal.Composition?Object(r["a"])(this.outputModal.Composition[0].TimeSpan.Duration)[0]:"0:0:0",this.outputModal.DurationMS=this.outputModal.Composition?Object(r["a"])(this.outputModal.Composition[0].TimeSpan.Duration)[1]:"0",this.showOutputsModal=!0,this.HLSError=!1},beforeUpdateOutputs:function(){var t=this;this.$refs["outputForm"].validate(function(e){e?t.updateOutputs():t.$Message.error(t.$t("PUBLIC.FORM_VALID_FAILED"))})},updateOutputs:function(){var t=this.job.Outputs.length;this.outputModal.template="".concat(this.outputModal.PresetId,"+").concat(this.templateInfo.templateName[this.outputModal.PresetId]);var e=this.isWaterMarkerOpen?Object.assign(this.outputModal,{Watermarks:[{InputKey:this.outputModal.InputKey}]}):this.outputModal;delete e.InputKey,this.isAutoCodec&&delete e.Watermarks,this.isComposition&&(e.Composition=[{TimeSpan:{StartTime:Object(r["c"])(this.outputModal.StartTime,this.outputModal.StartTimeMS),Duration:Object(r["c"])(this.outputModal.Duration,this.outputModal.DurationMS)}}]),delete e.StartTime,delete e.StartTimeMS,delete e.Duration,delete e.DurationMS,this.outputIndex===t?this.job.Outputs.push(e):this.job.Outputs.splice(this.outputIndex,1,e),this.showOutputsModal=!1,this.updateMPNames(this.job.Outputs)},deleteOutput:function(t){this.job.Outputs.splice(t,1),this.updateMPNames(this.job.Outputs)},addShot:function(){this.shotModal=_.clone(h),this.shotIndex=this.job.Snapshots.length,this.showShotsModal=!0},beforeUpdateShots:function(){var t=this;this.$refs["shotsForm"].validate(function(e){e?t.updateShots():t.$Message.error(t.$t("PUBLIC.FORM_VALID_FAILED"))})},updateShots:function(){var t=this.job.Snapshots.length,e=_.clone(this.shotModal);"auto"!==e.Resolution&&(e.Resolution="".concat(e.width,"*").concat(e.height)),delete e.width,delete e.height,this.shotIndex===t?this.job.Snapshots.push(e):this.job.Snapshots.splice(this.shotIndex,1,e),this.showShotsModal=!1},editShot:function(t){this.shotIndex=t,this.shotModal=_.clone(this.job.Snapshots[t]),"auto"!==this.shotModal.Resolution&&(this.shotModal.width=this.shotModal.Resolution.split("*")[0],this.shotModal.height=this.shotModal.Resolution.split("*")[1],this.shotModal.Resolution="value"),this.showShotsModal=!0},deleteShot:function(t){this.job.Snapshots.splice(t,1)},templateChange:function(t){this.HLSShow=this.isTS(t),this.HLSShow||(this.outputModal.SegmentDuration=0),this.isAutoCodec=this.isAC(t)},timeChange:function(t,e){this.outputModal[e]=t},isAC:function(t){return!!t&&"auto"===this.templateInfo.templateVideoCodec[t]},isTS:function(t){return!!t&&"ts"===this.templateInfo.templateContainer[t]},pipeChange:function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,_.forEach(this.pipes,function(t){t.Id===e.job.PipelineId&&(e.pipeInputBucket=t.InputBucket)});case 2:this.getFiles();case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),updateMPNames:function(){var t=this,e=this.templateInfo.templateContainer;this.MPNames=[],this.job.Outputs.forEach(function(s){"ts"===e[s.PresetId]&&t.MPNames.push(s.Key)})},getFiles:function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(){var e,s,a=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=a.length>0&&void 0!==a[0]?a[0]:"",t.next=3,Object(u["d"])("listObjects",{Bucket:this.pipeInputBucket,MaxKeys:50,Prefix:e});case 3:s=t.sent,this.fileList=s.Contents,this.fileInfo=!!s.IsTruncated;case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),validateName:function(t,e,s){!e&&this.MPOpen?s(new Error(this.$t("VIDEO.FILE_NAME_SUFFIX_CANNOT_EMPTY"))):s()},validateOutputKeys:function(t,e,s){0===e.length&&this.MPOpen?s(new Error("请选择输出文件名")):s()},validateInputs:function(t,e,s){e[0].Key?s():s(new Error(this.$t("VIDEO.SRC_FILE_INFO")))},validateSegment:function(t,e,s){this.isTS(this.outputModal.PresetId)&&this.MPOpen&&0===e?s(new Error(this.$t("VIDEO.HLS_SLICE_LENGTH_CANNOT_BE_0"))):s()},validateWidth:function(t,e,s){"auto"!==this.shotModal.Resolution?Number.isInteger(e)?e<1?s(new Error(this.$t("PUBLIC.NOT_LESS",{num:"1"}))):s():s(new Error(this.$t("PUBLIC.NUM_PLEASE"))):s()},validateInputKey:function(t,e,s){this.isAutoCodec||!this.isWaterMarkerOpen||e?s():s(new Error("请填写水印文件key"))}}},p={Inputs:[{Key:""}],OutputKeyPrefix:"",Outputs:[],Snapshots:[],Playlists:{Format:"HLSv3",Name:"",OutputKeys:[]},PipelineId:""},d={Key:"",PresetId:"",SegmentDuration:0,StartTime:"0:0:0",StartTimeMS:"0",Duration:"0:0:0",DurationMS:"0"},h={Key:"",Format:"jpg",Time:"0",Interval:"1",Number:"1",Resolution:"auto",AspectRatio:"auto",width:"",height:""},m=c,f=(s("42ad"),s("2877")),I=Object(f["a"])(m,a,i,!1,null,"5de74720",null);I.options.__file="JobEdit.vue";e["default"]=I.exports},4028:function(t,e,s){},"42ad":function(t,e,s){"use strict";var a=s("4028"),i=s.n(a);i.a},"752a":function(t,e,s){"use strict";s.d(e,"t",function(){return c}),s.d(e,"j",function(){return p}),s.d(e,"u",function(){return d}),s.d(e,"c",function(){return h}),s.d(e,"f",function(){return m}),s.d(e,"g",function(){return f}),s.d(e,"h",function(){return I}),s.d(e,"v",function(){return v}),s.d(e,"l",function(){return _}),s.d(e,"p",function(){return b}),s.d(e,"q",function(){return O}),s.d(e,"s",function(){return E}),s.d(e,"r",function(){return S}),s.d(e,"o",function(){return M}),s.d(e,"n",function(){return g}),s.d(e,"m",function(){return C}),s.d(e,"k",function(){return y}),s.d(e,"e",function(){return T}),s.d(e,"a",function(){return w}),s.d(e,"b",function(){return P}),s.d(e,"i",function(){return N}),s.d(e,"d",function(){return D}),s.d(e,"y",function(){return k}),s.d(e,"A",function(){return $}),s.d(e,"x",function(){return R}),s.d(e,"z",function(){return x}),s.d(e,"w",function(){return L});var a=s("dd1f"),i="".concat(location.protocol,"//"),o="/v2/",n="/2012-09-25/",r=function(t){return i+a["a"].apiHost+o+t},u=function(t){return i+a["a"].transcoderHOST+n+t},l=function(t){return i+a["a"].imgxHOST+t},c=r("superuser/redirect/bucket"),p=r("node/list"),d=(r("list/partition"),r("user/list/sub")),h=(r("user/create/sub_user"),r("user/list/sub_acl"),r("user/update/sub_acl"),r("user/create/user"),r("user/list/bound_user")),m=(r("user/list/user"),r("user/bind/user"),r("user/unbind/user"),r("group/list")),f=r("group/move"),I=r("group/read_only"),v=r("traffic/list"),_=r("partition/used/stats"),b=r("partition/used/detail"),O=r("partition/used/list"),E=r("partition/used/set"),S=r("partition/used/move"),M=r("partition/used/delete"),g=r("partition/unused/list"),C=r("partition/unused/add"),y=r("partition/deleted/list"),T=r("retrieve"),w=r("access"),P=r("user/add/service"),N=l("/image-example/"),D=r("custom_domain"),k=function(t){return r("bill/transcode".concat(t))},$=function(t){return u(t)},R=function(t){return r("bill/storage_old".concat(t))},x=function(t){return r("bill/storage".concat(t))},L=function(t){return r("bill/storage_bandwidth".concat(t))}},"7cdf":function(t,e,s){var a=s("5ca1");a(a.S,"Number",{isInteger:s("9c12")})},"8afe":function(t,e,s){"use strict";function a(t){if(Array.isArray(t)){for(var e=0,s=new Array(t.length);e<t.length;e++)s[e]=t[e];return s}}function i(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function n(t){return a(t)||i(t)||o()}s.d(e,"a",function(){return n})},9093:function(t,e,s){var a=s("ce10"),i=s("e11e").concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return a(t,i)}},"9c12":function(t,e,s){var a=s("d3f4"),i=Math.floor;t.exports=function(t){return!a(t)&&isFinite(t)&&i(t)===t}},aa77:function(t,e,s){var a=s("5ca1"),i=s("be13"),o=s("79e5"),n=s("fdef"),r="["+n+"]",u="​",l=RegExp("^"+r+r+"*"),c=RegExp(r+r+"*$"),p=function(t,e,s){var i={},r=o(function(){return!!n[t]()||u[t]()!=u}),l=i[t]=r?e(d):n[t];s&&(i[s]=l),a(a.P+a.F*r,"String",i)},d=p.trim=function(t,e){return t=String(i(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(c,"")),t};t.exports=p},c5f6:function(t,e,s){"use strict";var a=s("7726"),i=s("69a8"),o=s("2d95"),n=s("5dbc"),r=s("6a99"),u=s("79e5"),l=s("9093").f,c=s("11e9").f,p=s("86cc").f,d=s("aa77").trim,h="Number",m=a[h],f=m,I=m.prototype,v=o(s("2aeb")(I))==h,_="trim"in String.prototype,b=function(t){var e=r(t,!1);if("string"==typeof e&&e.length>2){e=_?e.trim():d(e,3);var s,a,i,o=e.charCodeAt(0);if(43===o||45===o){if(s=e.charCodeAt(2),88===s||120===s)return NaN}else if(48===o){switch(e.charCodeAt(1)){case 66:case 98:a=2,i=49;break;case 79:case 111:a=8,i=55;break;default:return+e}for(var n,u=e.slice(2),l=0,c=u.length;l<c;l++)if(n=u.charCodeAt(l),n<48||n>i)return NaN;return parseInt(u,a)}}return+e};if(!m(" 0o1")||!m("0b1")||m("+0x1")){m=function(t){var e=arguments.length<1?0:t,s=this;return s instanceof m&&(v?u(function(){I.valueOf.call(s)}):o(s)!=h)?n(new f(b(e)),s,m):b(e)};for(var O,E=s("9e1e")?l(f):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;E.length>S;S++)i(f,O=E[S])&&!i(m,O)&&p(m,O,c(f,O));m.prototype=I,I.constructor=m,s("2aba")(a,h,m)}},fdef:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);