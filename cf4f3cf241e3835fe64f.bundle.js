(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-47c43957"],{2001:function(t,e,c){"use strict";c.r(e);var n=function(){var t=this,e=t.$createElement,c=t._self._c||e;return c("div",{staticClass:"bsc-bucket"},[t.isSubUser?t._e():c("div",{staticClass:"layout-bsc-toolbar"},[c("div",[c("Button",{staticClass:"button-bsc-add-bucket",attrs:{type:"primary"},on:{click:function(e){t.createBucketModal=!0}}},[t._v(t._s(t.$t("STORAGE.ADD_BUCKET")))]),c("Tooltip",{attrs:{content:t.$t("STORAGE.FOLDER_INFO"),disabled:!!t.selectedBucket.Name,placement:"top"}},[c("Button",{staticClass:"button-bsc-add-bucket",attrs:{disabled:!t.selectedBucket.Name,type:"primary"},on:{click:function(e){t.goBucketSettings()}}},[t._v(t._s(t.$t("STORAGE.BUCKET_SETTING")))])],1),c("Tooltip",{attrs:{content:t.$t("STORAGE.FOLDER_INFO"),disabled:!!t.selectedBucket.Name,placement:"top"}},[c("Button",{directives:[{name:"show",rawName:"v-show",value:t.canShowPicture,expression:"canShowPicture"}],staticClass:"button-bsc-add-bucket",attrs:{disabled:!t.selectedBucket.Name,type:"primary"},on:{click:function(e){t.goPictureStyles()}}},[t._v(t._s(t.$t("STORAGE.PIC_STYLE")))])],1),c("Tooltip",{attrs:{content:t.$t("STORAGE.FOLDER_INFO"),disabled:!!t.selectedBucket.Name,placement:"top"}},[c("Button",{staticClass:"button-bsc-add-bucket",attrs:{disabled:!t.selectedBucket.Name,type:"primary"},on:{click:function(e){t.deleteBucketConfirm()}}},[t._v(t._s(t.$t("STORAGE.DELETE_BUCKET")))])],1)],1)]),c("div",{staticClass:"bsc-flex-section"},[t._l(t.bucketList,function(e){return t.isNoBuckets?t._e():c("div",{key:e.Name,staticClass:"bucket",class:{"bucket-selected":e.selected},on:{click:function(c){t.rowClick(e)},dblclick:function(c){t.dbClick(e)}}},[c("span",{staticClass:"span-filename"},[t._v(t._s(e.Name))])])}),t.isNoBuckets?c("span",{staticClass:"no-bucket"},[t._v(t._s(t.$t("STORAGE.NO_BUCKET")))]):t._e()],2),c("Modal",{attrs:{title:t.$t("STORAGE.ADD_BUCKET")},on:{"on-ok":t.addBucket,"on-cancel":function(e){t.inputCheck=!1,t.createBucketValue=""}},model:{value:t.createBucketModal,callback:function(e){t.createBucketModal=e},expression:"createBucketModal"}},[c("Input",{attrs:{autofocus:"",placeholder:t.$t("STORAGE.ADD_BUCKET_PLACEHOLDER"),pattern:"/^([a-z0-9][a-z0-9\\-]*[.])*([a-z0-9][a-z0-9\\-]*)*$/"},on:{"on-enter":t.addBucket},model:{value:t.createBucketValue,callback:function(e){t.createBucketValue=e},expression:"createBucketValue"}}),c("span",{staticClass:"info-input-error"},[t._v(t._s(t.inputCheck?t.$t("STORAGE.ADD_BUCKET_CHECK"):""))])],1)],1)},s=[],a=(c("aba3"),c("25d7"),c("9382"),c("b267")),r=c("ff66"),i=c("7265"),u=c("23d5"),o=c.n(u),l=c("7340"),k=c("4360"),h=c("365c"),d={data:function(){return{createBucketValue:"",fetchDone:!1,createBucketModal:!1,inputCheck:!1,bucketList:[],selectedBucket:{},iconSize:18}},computed:{canShowPicture:function(){return this.$store.state.manager.length&&this.$store.state.manager[0].username!==this.$store.state.current.username?Object(l["a"])("IMGX")&&Object(l["a"])("WRITE_USER",!0):Object(l["a"])("IMGX")},bucket:function(){return this.$route.params.bucket||""},isSubUser:function(){return Object(l["a"])("SUBUSER")},isNoBuckets:function(){return this.fetchDone&&this.bucketList&&0===this.bucketList.length}},watch:{createBucketValue:function(t){this.inputCheck=!(t.length>=3)}},created:function(){this.getBucketList()},methods:{getBucketList:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){var e,c,n=this,s=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=s.length>0&&void 0!==s[0]&&s[0],t.next=3,this.$store.dispatch("getBuckets",e);case 3:c=t.sent,this.fetchDone=!0,this.isSubUser?c.Buckets.forEach(function(t){n.getBucketAcl(t.Name).then(function(e){e.Grants.forEach(function(e){e.Grantee.ID!==k["a"].state.current.username||"FULL_CONTROL"!==e.Permission&&"READ"!==e.Permission||(t.CreationDate=o()(t.CreationDate).format("YYYY-MM-DD HH:mm"),n.bucketList.push(t))})})}):this.bucketList=_.forEach(c.Buckets,function(t){t.CreationDate=o()(t.CreationDate).format("YYYY-MM-DD HH:mm")}),this.bucketList=_.forEach(this.bucketList,function(t,e){t.selected=n.bucket?t.Name===n.bucket:0===e}),this.selectedBucket=this.$route.params.bucket&&this.bucketList?this.bucketList.filter(function(t){return t.Name===n.$route.params.bucket})[0]:this.bucketList&&this.bucketList.length>0?this.bucketList[0]:{};case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),deleteBucketConfirm:function(){var t=this,e=this.selectedBucket;this.$Modal.confirm({content:this.$t("STORAGE.DELETE_CONFIRMED",{fileName:e.Name}),okText:this.$t("PUBLIC.CONFIRMED"),cancelText:this.$t("PUBLIC.CANCLE"),title:this.$t("PUBLIC.DELETE"),onOk:function(){return t.deleteBucket(e)}})},deleteBucket:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.$Loading.start(),t.next=4,Object(r["d"])("deleteBucket",{Bucket:e.Name});case 4:return t.next=6,this.$store.dispatch("getBuckets",!0);case 6:Object(i["l"])(this.bucketList,e),this.selectedBucket={},_.each(document.querySelector(".bsc-flex-section").childNodes,function(t){t.classList.remove("bucket-selected")}),this.$Loading.finish(),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](0),this.$Loading.error();case 15:case"end":return t.stop()}},t,this,[[0,12]])}));return function(e){return t.apply(this,arguments)}}(),goBucketSettings:function(){var t=this.selectedBucket;this.$router.push({name:"bucketSettings",params:{bucket:t.Name,tabName:"permission"}})},goPictureStyles:function(){var t=this.selectedBucket;this.$router.push({name:"pictureStyles",params:{bucket:t.Name}})},rowClick:function(t){this.selectedBucket=t,this.bucketList.forEach(function(e){e.selected=e===t})},addBucket:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.createBucketModal=!1,this.createBucketValue=this.createBucketValue.trim(),!(this.createBucketValue.length>2)){t.next=12;break}return t.next=5,Object(r["d"])("createBucket",{Bucket:this.createBucketValue});case 5:return this.$Message.success(this.$t("STORAGE.ADD_BUCKET_SUCCESS")),t.next=8,this.getBucketList(!0);case 8:Object(l["a"])("SUB")&&this.createRedirectBucket(this.createBucketValue),this.createBucketValue="",t.next=13;break;case 12:this.$Message.warning(this.$t("STORAGE.ADD_BUCKET_CHECK"));case 13:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),dbClick:function(t){this.$router.push({name:"file",params:{bucket:t.Name,prefix:"noprefix"}})},getBucketAcl:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(r["d"])("getBucketAcl",{Bucket:e});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),createRedirectBucket:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){var c;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(h["p"])();case 2:return c=t.sent,t.next=5,Promise.all(c.map(function(t){return Object(h["T"])({original:e,username:t.username,redirect:e+"-"+t.username.replace(/\W|_/g,"").toLowerCase(),bucket_acl:["READ_ACP"],file_acl:["READ_ACP"]})}));case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}},b=d,f=(c("e3c4"),c("048f")),p=Object(f["a"])(b,n,s,!1,null,"3dab38aa",null);p.options.__file="Bucket.vue";e["default"]=p.exports},"5c31":function(t,e,c){},e3c4:function(t,e,c){"use strict";var n=c("5c31"),s=c.n(n);s.a}}]);